<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>BLE Teste</title>
	
  <link rel="stylesheet" type="text/css" href="styles.css" media="screen" />
</head>
<body>
  <h2>Conectar ao ESP32</h2>
  <button onclick="conectar()">Conectar</button>
  <p id="status">Status: aguardando...</p>

  <script>
    async function conectar() {
      try {
        const device = await navigator.bluetooth.requestDevice({
          filters: [{ namePrefix: 'ESP32' }],
          optionalServices: ['4fafc201-1fb5-459e-8fcc-c5c9c331914b']
        });

        document.getElementById("status").innerText = "Dispositivo selecionado: " + device.name;

        device.addEventListener("gattserverdisconnected", () => {
          document.getElementById("status").innerText = "Desconectado. Retornando Ã  index.html";
          window.location.href = "index.html";
        });

        const server = await device.gatt.connect();
        document.getElementById("status").innerText = "Conectado com sucesso. Redirecionando...";
        setTimeout(() => {
          window.location.href = "progCaixa.html";
        }, 1000);

      } catch (error) {
        document.getElementById("status").innerText = "Erro: " + error;
      }
    }
  </script>
</body>
</html>
